language: perl

perl:
- '5.14'
- '5.12'
- '5.10'

env:
  matrix:
  - COVERALLS=true  DB=mysql
  - COVERALLS=false DB=mysql
  - COVERALLS=false DB=sqlite
  global:
    secure: V4m6EvyHDDTbT/+NqteOGQbnHvrPUoVyXW02fLi/7/WckRroLqj4dmTHBEmQFdGDfYRS+/WkEijU2qNAe1A0Hlh79eWPvSZsiCTjEgt+0quNN+lYJGwKzLI27xM9YAXNCgVgpSsRLDcluf+bNHECKdpJPFL2TvgNa5vbbesxOHiUw8i4g/C66h4e8D2OnUdvNePfuSoqGpK2Q+lotQyQzI2nVjDsLtNc9VlGKB/EOKF9w5Ei/RYnxli58qG2gKLN8ut4oO8MAzCNfcLzfJFrqa43znW9HIhzw8JH2SQsBb6q1bXkLHB3Wu23w3G0bCgOVmrFzC/bxTdTOZBxGSAJjbEnMOjDqtNeMli5suRdo/5CvYQ42zVf9d0UxyX/AWuVicjKi6q4rujd/z55hm+Dyd5UBHjWg5QoeGqNYaU29hkLOTo9P4wKEvjdOF0ccU6lTad0I5nDSzRWfYAHcJWajE+Ms3TZ/dDZ2PfkPRLshEtufx++eEnKB1YMJaLi8e7A10RI9A8YZqerlk/Amo3C6aljCl4qA5G5ZBhuTGDgXXPxZC0xKQ72Myz/iKs3jrjbz2s3JFVQD0AamVBIE7HpprSGEc0uSXhSAuhtBINawcWod4ut/FbxP/de821BkRnEppt2n5bVdd530H88gQPiIcZ2ZlPf6tc7mXWGTFOoOeE=

sudo: false

addons:
  apt:
    packages:
    - unzip

before_install:
  - git clone --branch master --depth 1 https://github.com/Ensembl/ensembl.git
  - git clone -b bioperl-release-1-6-1 --depth 1 https://github.com/bioperl/bioperl-live.git

install:
  - cpanm -v --installdeps --notest .
  - cpanm -n Devel::Cover::Report::Coveralls
  - cpanm -n DBD::SQLite
  - cp travisci/MultiTestDB.conf.travisci.mysql  modules/t/MultiTestDB.conf.mysql
  - cp travisci/MultiTestDB.conf.travisci.SQLite modules/t/MultiTestDB.conf.SQLite
  - mysql -u root -h localhost -e 'GRANT ALL PRIVILEGES ON *.* TO "travis"@"%"'

script: "./travisci/harness.sh"

jobs:
  include:
  - stage: trigger_dependent_builds
    script: "./travisci/trigger-dependent-build.sh"

matrix:
  exclude:
  - perl: '5.10'
    env: COVERALLS=false DB=mysql
  - perl: '5.12'
    env: COVERALLS=false DB=sqlite
  - perl: '5.12'
    env: COVERALLS=true  DB=mysql
  - perl: '5.14'
    env: COVERALLS=false DB=sqlite
  - perl: '5.14'
    env: COVERALLS=true  DB=mysql

notifications:
  email:
    on_success: always
    on_failure: always
